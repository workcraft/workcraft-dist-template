<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>tutorial:method:hierarchical_design:start - [Workcraft]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="theme-color" content="#008800"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="tutorial,method,hierarchical_design,start"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.html" title="Workcraft"/>
<link rel="start" href="start.html"/>
<link rel="contents" href="start.html" title="Sitemap"/>
<link rel="manifest" href="../../lib/exe/manifest.html"/>
<link rel="alternate" type="application/rss+xml" title="Changes" />
<link rel="alternate" type="application/rss+xml" title="Current namespace" />
<link rel="edit" title="Edit this page" href="start.html"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="../../_export/xhtml/tutorial/method/hierarchical_design/start.xhtml"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="../../_export/raw/tutorial/method/hierarchical_design/start.raw"/>
<link rel="canonical" href="http://workcraft.org/tutorial/method/hierarchical_design/start"/>
<link rel="stylesheet" href="../../lib/exe/css.php.t.dokuwiki-light-export.css"/>
<!--[if gte IE 9]><!-->
<script >/*<![CDATA[*/var NS='tutorial:method:hierarchical_design';var SIG=" --- \/\/[[support@workcraft.org| ]] 2025\/01\/06 12:48\/\/";var JSINFO = {"fastwiki":{"secedit":1,"preview":1,"fastpages":1,"save":0,"fastshow":0,"fastshow_same_ns":1,"fastshow_include":"","fastshow_exclude":"","preload":0,"preload_head":"====47hsjwycv782nwncv8b920m8bv72jmdm3929bno3b3====","preload_batchsize":10,"preload_per_page":100,"locktime":840,"usedraft":1,"text_btn_show":"Show page","templatename":"dokuwiki-light-export"},"plugin_folded":{"hide":"hide","reveal":"reveal"},"move_renameokay":true,"move_allowrename":true,"plugins":{"vshare":{"youtube":"youtube\\.com\/.*[&?]v=([a-z0-9_\\-]+)","vimeo":"vimeo\\.com\\\/(\\d+)","slideshare":"slideshare.*id=(\\d+)","dailymotion":"dailymotion\\.com\/video\/([a-z0-9]+)","archiveorg":"archive\\.org\/(?:embed|details)\/([a-zA-Z0-9_\\-]+)","soundcloud":"soundcloud\\.com\/([\\w-]+\/[\\w-]+)","niconico":"nicovideo\\.jp\/watch\/(sm[0-9]+)","bitchute":"bitchute\\.com\\\/video\\\/([a-zA-Z0-9_\\-]+)","coub":"coub\\.com\\\/view\\\/([a-zA-Z0-9_\\-]+)","odysee":"odysee\\.com\/\\$\/(?:embed|download)\/([-%_?=\/a-zA-Z0-9]+)","youku":"v\\.youku\\.com\/v_show\/id_([0-9A-Za-z=]+)\\.html","bilibili":"bilibili\\.com\\\/video\\\/(BV[0-9A-Za-z]+)","msoffice":"(?:office\\.com.*[&?]videoid=([a-z0-9\\-]+))","msstream":"microsoftstream\\.com\\\/video\\\/([a-f0-9\\-]{36})"}},"id":"tutorial:method:hierarchical_design:start","namespace":"tutorial:method:hierarchical_design","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script src="../../lib/exe/jquery.php.t.dokuwiki-light-export.js" defer="defer">/*<![CDATA[*/
/*!]]>*/</script>
<script src="../../lib/exe/js.php.t.dokuwiki-light-export.js" defer="defer">/*<![CDATA[*/
/*!]]>*/</script>
<!--<![endif]-->
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="../../favicon.ico" />
<link rel="apple-touch-icon" href="../../apple-touch-icon.png" />
    </head>

<body>
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_dokuwiki-light-export loggedIn    ">

        
<!-- ********** HEADER ********** -->
<header id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <h1 class="logo"><a href="../../start.html"  accesskey="" title=""><img src="../../logo.png" width="381" height="64" alt="" /></a></h1>
            </div>

    <hr class="a11y" />
</div></header><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <main id="dokuwiki__content"><div class="pad group">
                
                <div class="pageId"><span>tutorial:method:hierarchical_design:start</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <div class="plugin_fastwiki_marker" style="display:none"></div><!-- TOC START -->
<div id="dw__toc" class="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#hierarchical_design_of_a_buck_controller">Hierarchical design of a buck controller</a></div></li>
<li class="level1"><div class="li"><a href="#verification_of_n-way_conformation">Verification of N-way conformation</a></div></li>
<li class="level1"><div class="li"><a href="#report_styles_for_violation_traces">Report styles for violation traces</a></div></li>
<li class="level1"><div class="li"><a href="#parallel_composition_of_module_stgs">Parallel composition of module STGs</a></div></li>
<li class="level1"><div class="li"><a href="#system-wide_verification">System-wide verification</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#standard_implementability_properties">Standard implementability properties</a></div></li>
<li class="level2"><div class="li"><a href="#custom_short_circuit_property">Custom short circuit property</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#synthesis_of_the_composition">Synthesis of the composition</a></div></li>
<li class="level1"><div class="li"><a href="#solutions">Solutions</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 id="verification_and_synthesis_of_hierarchical_designs">Verification and synthesis of hierarchical designs</h1>
<div class="level1">

<p>
In this tutorial we revisit the <a href="../../design/hierarchical_buck/start.html" class="wikilink1" title="tutorial:design:hierarchical_buck:start" data-wiki-id="tutorial:design:hierarchical_buck:start">hierarchical buck converter</a> to verify the conformation of its modules and learn how their parallel composition can be used for verification of system-wide properties and (sometimes) for deriving a better circuit implementation.
</p>

</div>

<h2 id="hierarchical_design_of_a_buck_controller">Hierarchical design of a buck controller</h2>
<div class="level2">

<p>
Let us start with the following decomposition of the design described in <a href="../../design/hierarchical_buck/start.html" class="wikilink1" title="tutorial:design:hierarchical_buck:start" data-wiki-id="tutorial:design:hierarchical_buck:start">hierarchical buck converter</a> – here the <code>CHARGE</code> module is further decomposed into <code>CHARGE_GP</code> and <code>CHARGE_GN</code> communicating with the help of an extra signal <code><span style='color:blue; '>pass</span></code>:
</p>

<p>
<img src="control-decomposed.circuit.svg" width="855" height="649" class="svgscaleinsert mediacenter" alt="tutorial:method:hierarchical_design:control-decomposed.circuit.svg">
</p>
<div class="wrap_info wrap_round wrap_center plugin_wrap" style="width: 90%;">
<p>
<code>WAIT</code> and <code>WAIT2</code> are predefined elements from the library of <a href="../../../help/a2a/start.html" class="wikilink1" title="a2a:start" data-wiki-id="a2a:start">Asynchronous Arbitration Primitives</a>.
</p>
</div><div class="wrap_hide plugin_wrap">
<p>
The behaviour of the <code>CYCLE</code> module captured by the below <abbr title="Signal Transition Graph">STG</abbr> is as follows: It waits for under-voltage condition and iteratively calls for a cycle of buck charging while under-voltage persists. When under-voltage condition is resolved there is choice whether to do another cycle of charging or not. The corresponding choice place <code>me</code> is tagged as a mutex place to hint the synthesis that it needs to be implemented by a mutex.
</p>
</div>
<p>
The behaviour of the <code>CYCLE</code> module was explained in the <a href="../../design/hierarchical_buck/start.html" class="wikilink1" title="tutorial:design:hierarchical_buck:start" data-wiki-id="tutorial:design:hierarchical_buck:start">hierarchical buck</a> tutorial and is captured by the following <abbr title="Signal Transition Graph">STG</abbr>:
</p>
<div class="plugin_wrap"><div class="table sectionedit7"><table class="inline">
	<tr class="row0">
		<td class="col0"> <img src="cycle-mutex.stg.svg" width="593" height="151" class="svgscaleinsert mediacenter" alt="tutorial:method:hierarchical_design:cycle-mutex.stg.svg"> </td>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  <abbr title="Signal Transition Graph">STG</abbr> specification of CYCLE module<br/>
<span class="wrap_download "><a href="cycle-mutex.stg.work" class="media mediafile mf_work" title="tutorial:method:hierarchical_design:cycle-mutex.stg.work (3.7 KB)">cycle-mutex.stg.work</a> (4 KiB)</span>  </td>
	</tr>
</table></div>
</div><div class="wrap_hide plugin_wrap">
<p>
A charging cycle of a buck has two distinctive phases:
</p>
<ol>
<li class="level1"><div class="li"> Upon request <code><span style='color:blue; '>chrg_req+</span></code> from the <code>CYCLE</code> module, <code>CHARGE_GP</code> switches PMOS power regulating transistor ON and waits for over-current condition at <code><span style='color:blue; '>oc_ctrl</span></code>/<code><span style='color:red; '>oc_san</span></code> interface. When over-current is detected <code>CHARGE_GP</code> switches PMOS transistor OFF and activates <code>CHARGE_GN</code> module by <code><span style='color:blue; '>pass+</span></code> signal.</div>
</li>
<li class="level1"><div class="li">  Once <code>CHARGE_GN</code> is activated by <code><span style='color:red; '>pass+</span></code> signal it switches NMOS transistor OFF and waits for zero-crossing condition on <code><span style='color:blue; '>zc_ctrl</span></code>/<code><span style='color:red; '>zc_san</span></code> interface. When zero-crossing is detected <code>CHARGE_GN</code> switches NMOS transistor OFF and acknowledges the completion of charging to <code>CYCLE</code> by <code><span style='color:blue; '>chrg_ack+</span></code>.</div>
</li>
</ol>
</div>
<p>
The <abbr title="Signal Transition Graph">STG</abbr> specifications of <code>CHARGE_GP</code> and <code>CHARGE_GN</code> are as follows:
</p>
<div class="group plugin_wrap"><div class="wrap_column wrap_half plugin_wrap"><div class="table sectionedit14"><table class="inline">
	<tr class="row0">
		<td class="col0"><img src="charge_gp.stg.svg" width="380" height="162" class="svgscaleinsert mediacenter" alt="tutorial:method:hierarchical_design:charge_gp.stg.svg"></td>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  <abbr title="Signal Transition Graph">STG</abbr> specification of <code>CHARGE_GP</code> module<br/>
<span class="wrap_download "><a href="charge_gp.stg.work" class="media mediafile mf_work" title="tutorial:method:hierarchical_design:charge_gp.stg.work (3.4 KB)">charge_gp.stg.work</a> (3 KiB)</span>  </td>
	</tr>
</table></div>
</div><div class="wrap_column wrap_half plugin_wrap"><div class="table sectionedit17"><table class="inline">
	<tr class="row0">
		<td class="col0"><img src="charge_gn.stg.svg" width="375" height="162" class="svgscaleinsert mediacenter" alt="tutorial:method:hierarchical_design:charge_gn.stg.svg"></td>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  <abbr title="Signal Transition Graph">STG</abbr> specification of CHARGE_GN module<br/>
<span class="wrap_download "><a href="charge_gn.stg.work" class="media mediafile mf_work" title="tutorial:method:hierarchical_design:charge_gn.stg.work (3.3 KB)">charge_gn.stg.work</a> (3 KiB)</span>  </td>
	</tr>
</table></div>
</div></div>
<p>
All these STGs can be verified and synthesised separately. However, it is possible to assemble an incorrect circuit from correct modules; the main focus of this tutorial is to verify and optimise the specification of the overall system.
</p>

</div>

<h2 id="verification_of_n-way_conformation">Verification of N-way conformation</h2>
<div class="level2">

<p>
An important system-level property is the <em>conformation</em> of each module to its environment, i.e. the module must never produce outputs that are not expected by its environment. Note that the environment of each module in the case of hierarchical design is the composition of all the other modules, and the property that each module conforms to the composition of all the other modules is called <em>N-way conformation</em>.
</p>

<p>
Let us verify N-way conformation for the modules of the buck controller. Capture or download the STGs for <code>CYCLE</code>, <code>CHARGE_GP</code>s and <code>CHARGE_GN</code> modules and save them as <code>cycle-mutex.stg.work</code>, <code>charge_gp.stg.work</code>, and <code>charge_gn.stg.work</code>, respectively. Open these three STGs in Workcraft and verify this property via <em>Verification→N-way conformation…</em> menu. In the <em>N-way conformation</em> dialog select the STGs of all the system modules as follows:
</p>

<p>
<img src="nway_conformation-dialog.png" class="mediacenter" loading="lazy" title="Configuration dialog for N-way conformation" alt="Configuration dialog for N-way conformation" />
</p>

<p>
Press <kbd class="__keyboard"><code>  OK  </code></kbd> button to start verification. The verification should pass indicating that N-way conformation holds.
</p>

<p>
As an experiment, change one of the module interfaces, e.g. delay <code><span style='color:red; '>pass-</span></code> input till after <code><span style='color:blue; '>zc_ctrl-</span></code> output in the <code>CHARGE_GN</code> by creating a causality arc to the former transition from the later. Note that now each individual module still passes all the standard verification checks, but the overall system is wrong, as <code>CHARGE_GP</code> produces <code><span style='color:blue; '>pass-</span></code> event that <code>CHARGE_GN</code> is not ready to receive. Repeating the verification of N-way conformation now yields a violation trace, together with the name of the offending signal:
</p>

<p>
<img src="nway_conformation-failure.png" class="mediacenter" loading="lazy" title="Failure of N-way conformation" alt="Failure of N-way conformation" />
</p>

<p>
Note that if <kbd class="__keyboard"><code> Play </code></kbd> button is pressed, then Workcraft automatically switches to the module <abbr title="Signal Transition Graph">STG</abbr> that produces the unexpected output and initiates its simulation with the reported violation trace.
</p>

<p>
N-way conformation is checked for all the modules in one go using their parallel composition. The violation trace of the composition is then projected to each module, and the module&#039;s state after the projection trace is then checked for any unexpectedly enabled output events, i.e. those events that are enabled in the module but not in the overall composition. If such an event is detected then the module does not conform to its environment. In the above example, output <code><span style='color:blue; '>pass-</span></code> becomes unexpectedly enabled in <code>CHARGE_GP</code> (as the modified <code>CHARGE_GN</code> is not ready to receive it) after the following sequence of events: <code>chrg_req+, gp+, gp_ack+, oc_ctrl+, oc_san+, gp-, gp_ack-, pass+, chrg_req-</code>.
</p>

</div>

<h2 id="report_styles_for_violation_traces">Report styles for violation traces</h2>
<div class="level2">

<p>
In larger designs debugging a violation of N-way conformation is a daunting task due to a large number of modules and complicated interaction between them. Hence Workcraft reports some extra information about the violation trace in the <em>Output</em> pane. The user can choose one of three possible reporting styles using <em>Edit→Preferences…→External tools→MPSat verification→Report style for conformation violation</em> setting. 
</p>

<p>
By default the violation trace is reported as a <em>Table</em> with projections of the trace on each module, one column per module (see the example below):
</p>
<ul>
<li class="level1"><div class="li"> The module (work file) names are in the table header.</div>
</li>
<li class="level1"><div class="li"> The last column represents the names of events in the violation trace.</div>
</li>
<li class="level1"><div class="li"> If a module participates in executing an event from the last column then its semantics is denoted on the intersection of the event&#039;s row and the module&#039;s column – <code>i</code> for input, <code>o</code> for output, <code>x</code> for internal, and <code>d</code> for dummy.</div>
</li>
<li class="level1"><div class="li"> The last row represents the unexpected event. The receivers not expecting this input are tagged by  <code>!</code> in this row.</div>
</li>
<li class="level1"><div class="li"> Finally, projections of the composition trace on each module are shown as a trace. If the trace triggers an unexpected signal transition then this transition is reported in a warning.</div>
</li>
</ul>
<pre class="code">[WARNING] N-way conformation is violated.
  charge_gn.stg
  | charge_gp.stg
  | | cycle-mutex.stg
  | | |  Projected events
  -----------------------
  . . x  me_r2+
  . . i  uv_san+
  . . x  me_r1-
  . . o  uv_ctrl-
  . i o  chrg_req+
  . o .  gp+
  . i .  gp_ack+
  . o .  oc_ctrl+
  . i .  oc_san+
  . o .  gp-
  . i .  gp_ack-
  i o .  pass+
  o . .  gn+
  i . .  gn_ack+
  o . .  zc_ctrl+
  i . .  zc_san+
  o . .  gn-
  i . .  gn_ack-
  o . i  chrg_ack+
  . . x  me_r2-
  . i o  chrg_req-
  ! o .  pass-
Legend: i - input; o - output; x - internal; d - dummy; ! - violation
Projection to &#039;charge_gn.stg&#039;: pass+, gn+, gn_ack+, zc_ctrl+, zc_san+, gn-, gn_ack-, chrg_ack+
Projection to &#039;charge_gp.stg&#039;: chrg_req+, gp+, gp_ack+, oc_ctrl+, oc_san+, gp-, gp_ack-, pass+, chrg_req-
[WARNING] Unexpected enabling of signal pass-
Projection to &#039;cycle-mutex.stg&#039;: me_r2+, uv_san+, me_r1-, uv_ctrl-, chrg_req+, chrg_ack+, me_r2-, chrg_req-</pre>

<p>
Another reporting style is <em>List</em> showing the events of the violation trace of the composition, with the names of the modules participating in executing this event (see the example below):
</p>
<ul>
<li class="level1"><div class="li"> If the event is a communication event, i.e. not a dummy and not an internal signal, then the sender is reported on the left of <code>→</code> and the receivers are reported on the right. Note that there is at most one sender (the unique module producing this output, or it arrives from the global environment), and there can be zero or more receivers. </div>
</li>
<li class="level1"><div class="li"> The events local to a particular module (i.e. dummies or internal signals) are reported without <code>→</code>. </div>
</li>
<li class="level1"><div class="li"> The last row represents the unexpected event; the receivers not expecting this input are reported with <code>(unexpected)</code> appended to their names. </div>
</li>
<li class="level1"><div class="li"> Finally, projections of the composition trace on each module are shown as a trace. If the trace triggers an unexpected signal transition then this transition is reported in a warning.</div>
</li>
</ul>
<pre class="code">[WARNING] N-way conformation is violated.
  me_r2+    : cycle-mutex.stg
  uv_san+   :  → cycle-mutex.stg
  me_r1-    : cycle-mutex.stg
  uv_ctrl-  : cycle-mutex.stg → 
  chrg_req+ : cycle-mutex.stg → charge_gp.stg
  gp+       : charge_gp.stg → 
  gp_ack+   :  → charge_gp.stg
  oc_ctrl+  : charge_gp.stg → 
  oc_san+   :  → charge_gp.stg
  gp-       : charge_gp.stg → 
  gp_ack-   :  → charge_gp.stg
  pass+     : charge_gp.stg → charge_gn.stg
  gn+       : charge_gn.stg → 
  gn_ack+   :  → charge_gn.stg
  zc_ctrl+  : charge_gn.stg → 
  zc_san+   :  → charge_gn.stg
  gn-       : charge_gn.stg → 
  gn_ack-   :  → charge_gn.stg
  chrg_ack+ : charge_gn.stg → cycle-mutex.stg
  me_r2-    : cycle-mutex.stg
  chrg_req- : cycle-mutex.stg → charge_gp.stg
  pass-     : charge_gp.stg → charge_gn.stg (unexpected)
Projection to &#039;charge_gn.stg&#039;: pass+, gn+, gn_ack+, zc_ctrl+, zc_san+, gn-, gn_ack-, chrg_ack+
Projection to &#039;charge_gp.stg&#039;: chrg_req+, gp+, gp_ack+, oc_ctrl+, oc_san+, gp-, gp_ack-, pass+, chrg_req-
[WARNING] Unexpected enabling of signal pass-
Projection to &#039;cycle-mutex.stg&#039;: me_r2+, uv_san+, me_r1-, uv_ctrl-, chrg_req+, chrg_ack+, me_r2-, chrg_req-</pre>

<p>
Finally, <em>Brief</em> report style shows a &#039;raw&#039; violation trace of the composition, its projections on each module, and the offending signal transition:
</p>
<pre class="code">[WARNING] N-way conformation is violated.
Violation trace of the composition: dum/1, uv_san+, dum/2, uv_ctrl-, chrg_req+, gp+, gp_ack+, oc_ctrl+, oc_san+, gp-, gp_ack-, pass+, gn+, gn_ack+, zc_ctrl+, zc_san+, gn-, gn_ack-, chrg_ack+, dum/3, chrg_req-
Projection to &#039;charge_gn.stg&#039;: pass+, gn+, gn_ack+, zc_ctrl+, zc_san+, gn-, gn_ack-, chrg_ack+
Projection to &#039;charge_gp.stg&#039;: chrg_req+, gp+, gp_ack+, oc_ctrl+, oc_san+, gp-, gp_ack-, pass+, chrg_req-
[WARNING] Unexpected enabling of signal pass-
Projection to &#039;cycle-mutex.stg&#039;: me_r2+, uv_san+, me_r1-, uv_ctrl-, chrg_req+, chrg_ack+, me_r2-, chrg_req-</pre>

</div>

<h2 id="parallel_composition_of_module_stgs">Parallel composition of module STGs</h2>
<div class="level2">

<p>
System decomposition into manageable modules is paramount both for comprehension by designers and for efficient speed-independent implementation by synthesis tools. As long as interface conformation is preserved, the designer can focus on optimisation, verification, and synthesis of individual modules.
However, verification of system-wide properties may require crossing the module boundaries, and to accomplish this the parallel composition of all the modules need to be constructed.
</p>

<p>
Let us build the parallel composition of <code>CYCLE</code>, <code>CHARGE_GP</code> and <code>CHARGE_GN</code> modules. Make sure their STGs are open in Workcraft (do not forget to undo the change of polarity for <code><span style='color:blue; '>pass</span></code> transitions) and select <em>Tools→Composition→Parallel composition [PComp]</em> menu. In the revealed <em>Parallel composition</em> dialog:
</p>
<ul>
<li class="level1"><div class="li"> Tick the STGs to be composed, i.e. <code>charge_gp.stg.work</code>, <code>charge_gn.stg.work</code>, and <code>cycle-mutex.stg.work</code>.</div>
</li>
<li class="level1"><div class="li"> Select <em>Make internal</em> option in order to convert the inter-module communication signals into internal.</div>
</li>
<li class="level1"><div class="li"> Tick <em>Guaranteed N-way conformation</em> option, as we have already verified this. (This allows the PComp backend to optimise the parallel composition.)</div>
</li>
</ul>

<p>
The dialog should look as follows:
</p>

<p>
<img src="parallel_composition-dialog.png" class="mediacenter" loading="lazy" title="Configuration dialog for parallel composition" alt="Configuration dialog for parallel composition" />
</p>

<p>
Press the <kbd class="__keyboard"><code>  OK  </code></kbd> button to compose these STGs – the result should look similar to this:
</p>
<div class="wrap_center plugin_wrap"><div class="table sectionedit20"><table class="inline">
	<tr class="row0">
		<td class="col0"> <img src="control-composed.stg.svg" width="872" height="196" class="svgscaleinsert mediacenter" alt="tutorial:method:hierarchical_design:control-composed.stg.svg"> </td>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  Parallel composition<br/>
<span class="wrap_download "><a href="control-composed.stg.work" class="media mediafile mf_work" title="tutorial:method:hierarchical_design:control-composed.stg.work (6 KB)">control-composed.stg.work</a> (6 KiB)</span>  </td>
	</tr>
</table></div>
</div><div class="wrap_tip wrap_center wrap_round plugin_wrap" style="width: 90%;">
<p>
If you did not tick <em>Guaranteed N-way conformation</em> option, then the composed <abbr title="Signal Transition Graph">STG</abbr> may have some redundant places (sometimes implicit within arcs). These places can be removed by resynthesis via <em>Conversion→Net synthesis [Petrify]</em> menu or individually, after checking their redundancy via <em>Check place redundancy</em> popup menu.
</p>
</div>
</div>

<h2 id="system-wide_verification">System-wide verification</h2>
<div class="level2">

</div>

<h3 id="standard_implementability_properties">Standard implementability properties</h3>
<div class="level3">

<p>
Verify the composition <abbr title="Signal Transition Graph">STG</abbr> using  <em>Verification→Consistency, deadlock freeness, input properness, output persistency, and mutex implementability (reuse unfolding) [MPSat]</em> menu (see <a href="../../help/verification.html" class="wikilink1" title="help:verification" data-wiki-id="help:verification">standard verification properties</a> for details). All these properties must hold for the specification to be implementable as a speed-independent circuit.
</p>

</div>

<h3 id="custom_short_circuit_property">Custom short circuit property</h3>
<div class="level3">

<p>
For our buck example one must verify that PMOS and NMOS transistors are never ON simultaneously (which would lead to a short circuit). Violation of this custom property can be formulated as a reachability analysis problem using <a href="../../help/reach.html" class="wikilink1" title="help:reach" data-wiki-id="help:reach">Reach language</a> (see <a href="../../design/basic_buck/start.html#formal_verification" class="wikilink1" title="tutorial:design:basic_buck:start" data-wiki-id="tutorial:design:basic_buck:start">verification of a basic buck controller</a> for details): <code>($S&quot;gp&quot; | $S&quot;gp_ack&quot;) &amp; ($S&quot;gn&quot; | $S&quot;gn_ack&quot;)</code>. This property refers to signals of several buck control modules, therefore it has to be checked on the composition of modules.
</p>

<p>
Let us verify the absence of a short circuit in the composition by defining a new custom property via <em>Verification→REACH assertion [MPSat]…</em> menu. Enter the above Reach predicate in the <em>REACH assertion</em> dialog. Note that the MPSat mode must be set to <em><abbr title="Signal Transition Graph">STG</abbr> reachability analysis</em> and the predicate must be <em>unsatisfiable</em> for the property to hold:
</p>

<p>
<img src="custom_property-dialog.png" class="mediacenter" loading="lazy" title="Custom property for short circuit" alt="Custom property for short circuit" />
</p>

<p>
Pressing the <kbd class="__keyboard"><code>  OK  </code></kbd> button should confirm that the property holds, i.e. no state is reachable that satisfies the short circuit predicate.
</p>

</div>

<h2 id="synthesis_of_the_composition">Synthesis of the composition</h2>
<div class="level2">

<p>
One of the important advantages of hierarchical design is that the modules can be synthesised separately. However, sometimes one can improve the implementation of the overall system by doing cross-boundary optimisations. This is done by composing several tightly coupled modules and synthesising the resulting <abbr title="Signal Transition Graph">STG</abbr>. This may occasionally result in a better circuit because:
</p>
<ul>
<li class="level1"><div class="li"> Composed STGs restrict the behaviours of each other, meaning some states become unreachable, adding don&#039;t-cares into minimisation tables during logic synthesis.</div>
</li>
<li class="level1"><div class="li"> The inter-module communication signals can be <em>hidden</em> (turned to dummies and/or contracted), i.e. fewer signals have to be implemented.</div>
</li>
</ul>
<div class="wrap_info wrap_center wrap_round plugin_wrap" style="width: 90%;">
<p>
Hiding signals does not always result in a smaller circuit. One of the reasons is that hiding may introduce CSC conflicts which have to be resolved, e.g. by inserting new signals. Note that MPSat and Petrify back-ends try to implicitly resolve CSC conflicts before proceeding with the synthesis. See the <a href="../csc_resolution/start.html" class="wikilink1" title="tutorial:method:csc_resolution:start" data-wiki-id="tutorial:method:csc_resolution:start">Resolution of encoding (CSC) conflicts</a> tutorial for more information about CSC conflicts.
</p>

<p>
Another problem is that <a href="../technology_mapping/start.html" class="wikilink1" title="tutorial:method:technology_mapping:start" data-wiki-id="tutorial:method:technology_mapping:start">Logic decomposition and technology mapping</a> are much more difficult for large STGs.
</p>
</div>
<p>
Let us evaluate the benefits of cross-boundary optimisation for the buck controller. In the composed <abbr title="Signal Transition Graph">STG</abbr> <code><span style='color:green; '>chrg_req</span></code>, <code><span style='color:green; '>pass</span></code>, and <code><span style='color:green; '>chrg_ack</span></code> used to be the inter-module communication signals, and therefore may be redundant in the composition. However, <code><span style='color:green; '>chrg_req</span></code> is also a mutex output and thus has to be preserved to satisfy the mutex protocol. Therefore, only <code><span style='color:green; '>pass</span></code> and <code><span style='color:green; '>chrg_ack</span></code> can be hidden. Select transitions of these two signals (one transition per signal is sufficient) and these signals via the <em>Conversion→Net synthesis hiding selected signals and dummies [Petrify]</em> menu. The simplified <abbr title="Signal Transition Graph">STG</abbr> should look similar to this (note that place <code>me</code> was renamed to <code>p0</code> by Petrify, but its <em>Mutex</em> tag was automatically restored from the context – in general this is not always possible and might be necessary to do manually):
</p>
<div class="wrap_center plugin_wrap"><div class="table sectionedit27"><table class="inline">
	<tr class="row0">
		<td class="col0"> <img src="control-simplified.stg.svg" width="849" height="241" class="svgscaleinsert mediacenter" alt="tutorial:method:hierarchical_design:control-simplified.stg.svg"> </td>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  Simplified composition<br/>
<span class="wrap_download "><a href="control-simplified.stg.work" class="media mediafile mf_work" title="tutorial:method:hierarchical_design:control-simplified.stg.work (5.6 KB)">control-simplified.stg.work</a> (6 KiB)</span>  </td>
	</tr>
</table></div>
</div>
<p>
Verify the obtained <abbr title="Signal Transition Graph">STG</abbr> for the standard speed-independent implementability properties via <em>Verification→Consistency, deadlock freeness, input properness, output persistency, and mutex implementability (reuse unfolding) [MPSat]</em> menu. Then proceed to the technology mapping, e.g. using Petrify (relying on its automatic CSC conflict resolution) – <em>Synthesis→Technology mapping [Petrify]</em> menu (by default gates from <code>libraries/workcraft.lib</code> are used; this can be changed under <em>Gate library for technology mapping</em> option in <em>Model→Digital circuit</em> preference that is accessible via <em>Edit→Preferences…</em> menu).
</p>

<p>
The area of the resultant circuit (reported via <em>Tools→Statistics→Circuit analysis</em>) is 220 units +  MUTEX. For comparison, when the controller modules are synthesised separately, the total area would be 256 units + MUTEX (16+MUTEX for <code>CYCLE</code>, 120 for <code>CHARGE_GP</code>, and 120 for <code>CHARGE_GN</code>), i.e. 14% reduction.
</p>

<p>
Note that even better results can be achieved by other optimisation techniques, such as concurrency reduction. For example, consider the reset phase of the <code>WAIT</code> elements in <code>CHARGE_GP</code> and <code>CHARGE_GN</code> modules. The reset of <code>WAIT</code> element is just a single gate delay and does not depend on the environment delay. It is quite reasonable to assume this would usually happen faster than switching a large power regulating transistor. Therefore, without sacrificing performance, one can reduce the concurrency of <code>WAIT</code> reset as follows:
</p>
<div class="group plugin_wrap"><div class="wrap_column wrap_half plugin_wrap"><div class="table sectionedit32"><table class="inline">
	<tr class="row0">
		<td class="col0"><img src="charge_gp-cr.stg.svg" width="392" height="162" class="svgscaleinsert mediacenter" alt="tutorial:method:hierarchical_design:charge_gp-cr.stg.svg"></td>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  <abbr title="Signal Transition Graph">STG</abbr> of CHARGE_GP module with concurrency reduction<br/>
<span class="wrap_download "><a href="charge_gp-cr.stg.work" class="media mediafile mf_work" title="tutorial:method:hierarchical_design:charge_gp-cr.stg.work (3.5 KB)">charge_gp-cr.stg.work</a> (3 KiB)</span>  </td>
	</tr>
</table></div>
</div><div class="wrap_column wrap_half plugin_wrap"><div class="table sectionedit35"><table class="inline">
	<tr class="row0">
		<td class="col0"><img src="charge_gn-cr.stg.svg" width="378" height="162" class="svgscaleinsert mediacenter" alt="tutorial:method:hierarchical_design:charge_gn-cr.stg.svg"></td>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  <abbr title="Signal Transition Graph">STG</abbr> of CHARGE_GN module with concurrency reduction<br/>
<span class="wrap_download "><a href="charge_gn-cr.stg.work" class="media mediafile mf_work" title="tutorial:method:hierarchical_design:charge_gn-cr.stg.work (3.5 KB)">charge_gn-cr.stg.work</a> (3 KiB)</span>  </td>
	</tr>
</table></div>
</div></div>
<p>
This concurrency reduction significantly simplifies the implementations of <code>CHARGE_GP</code> and <code>CHARGE_GN</code>, down to 60 units, so the area of the whole controller is reduced to 136 units. Using the composition technique the area can be further reduced down to 128 units (equivalent to removing a single inverter).
</p>

<p>
To conclude, hierarchical design is the recommended method for designing controllers with more than a handful of signals. This tutorial explained how to verify system-wide properties of such designs. The simplicity of synthesising individual modules (compared to synthesising the overall system) is a very important advantage of hierarchical designs, making the process much more predictable. Moreover, if cross-boundary optimisation is desirable, one can always automatically derive the <abbr title="Signal Transition Graph">STG</abbr> for the overall system by composing the modules and hiding the inter-module communication. The resulting large <abbr title="Signal Transition Graph">STG</abbr> is likely to be challenging to synthesise, but so would the monolithic specification of the overall system if one did not use the hierarchical approach.
</p>

</div>

<h2 id="solutions">Solutions</h2>
<div class="level2">

<p>
Download all the Workcraft models discussed in this tutorial here:
</p>

<p>
<span class="wrap_download "><a href="composition.zip" class="media mediafile mf_zip" title="tutorial:method:hierarchical_design:composition.zip (48.7 KB)">All STGs and circuits</a> (49 KiB)</span>
</p>

</div>
<div class="level1">
<div class="plugin_include_content plugin_include__tutorial:feedback" id="plugin_include__tutorial__feedback">
<div class="wrap_hide plugin_wrap"><pre class="code">===== Feedback =====</pre>
<form class="bureaucracy__plugin" id="bureaucracy__plugin1" enctype="multipart/form-data" method="post" action="start.html" accept-charset="utf-8"><div class="no">
<input type="hidden" name="sectok" value="2fe5a140958a484281ffc39019bb05f5" /><input type="hidden" name="id" value="tutorial:method:hierarchical_design:start" /><input type="hidden" name="bureaucracy[$$id]" value="1" /><fieldset ><legend>Comments or suggestions for improving this tutorial</legend>
<label><span>Name (optional)</span> <input type="text" name="bureaucracy[1]" class="edit" /></label>
<label><span>Email (optional)</span> <input type="text" name="bureaucracy[2]" class="edit" /></label>
<label class=" textareafield">
    <span>Feedback <sup>*</sup></span>
    <textarea name="bureaucracy[3]" id="" rows="10" cols="10" class="edit required&quot; required=&quot;required"></textarea>
</label><button type="submit">Submit</button>
</fieldset>
</div></form>
</div><div class="wrap_hide plugin_wrap"><ul>
<li class="level1"><div class="li"> As discussed in <a href="https://www.dokuwiki.org/plugin:include#controlling_header_size_in_included_pages" class="urlextern" title="https://www.dokuwiki.org/plugin:include#controlling_header_size_in_included_pages" rel="ugc nofollow">https://www.dokuwiki.org/plugin:include#controlling_header_size_in_included_pages</a>, by default, the headers in included pages start one level lower than the last header in the current page. This can be tweaked by adding an empty header above the include:\\<pre class="code">====== ======
{{page&gt;:tutorial:feedback&amp;inline}}</pre>
</div>
</li>
<li class="level1"><div class="li"> For offline help generation the content of <code>feedback</code> page should be temporary wrapped in <code>&lt;WRAP hide&gt;</code>. Note that the headers still propagate to the table of contents even if inside the hidden wrap. Therefore the <strong>Feedback</strong> title needs to be converted to something else, e.g. to code by adding two spaces in front.</div>
</li>
</ul>
</div></div>

</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo">
                    Copyright &copy; 2014-2024 workcraft.org                </div>

                
                <hr class="a11y" />
            </div></main><!-- /content -->

        </div><!-- /wrapper -->

            </div></div><!-- /site -->

    <div class="no"><img src="../../lib/exe/taskrunner.27d4e87c46442bdbf8a2aa9b30073124.gif" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div></body>
</html>
