<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>tutorial:method:handshake_verification:start - Workcraft</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="theme-color" content="#008800"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="tutorial,method,handshake_verification,start"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.html" title="Workcraft"/>
<link rel="start" href="start.html"/>
<link rel="contents" href="start.html" title="Sitemap"/>
<link rel="manifest" href="../../lib/exe/manifest.html"/>
<link rel="alternate" type="application/rss+xml" title="Changes" />
<link rel="alternate" type="application/rss+xml" title="Current namespace" />
<link rel="edit" title="Edit this page" href="start.html"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="../../_export/xhtml/tutorial/method/handshake_verification/start.xhtml"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="../../_export/raw/tutorial/method/handshake_verification/start.raw"/>
<link rel="canonical" href="https://workcraft.org/tutorial/method/handshake_verification/start"/>
<link rel="stylesheet" href="../../lib/exe/css.php.t.dokuwiki-light-export.css"/>
<!--[if gte IE 9]><!-->
<script >/*<![CDATA[*/var NS='tutorial:method:handshake_verification';var SIG=" --- \/\/[[support@workcraft.org| ]] 2022\/07\/19 19:43\/\/";var JSINFO = {"fastwiki":{"secedit":1,"preview":1,"fastpages":1,"save":0,"fastshow":0,"fastshow_same_ns":1,"fastshow_include":"","fastshow_exclude":"","preload":false,"preload_head":"====47hsjwycv782nwncv8b920m8bv72jmdm3929bno3b3====","preload_batchsize":false,"preload_per_page":false,"locktime":840,"usedraft":1,"text_btn_show":"Show page","templatename":"dokuwiki-light-export"},"plugin_folded":{"hide":"hide","reveal":"reveal"},"move_renameokay":true,"plugins":{"vshare":{"youtube":"youtube\\.com\/.*[&?]v=([a-z0-9_\\-]+)","vimeo":"vimeo\\.com\\\/(\\d+)","slideshare":"slideshare.*id=(\\d+)","dailymotion":"dailymotion\\.com\/video\/([a-z0-9]+)","archiveorg":"archive\\.org\/(?:embed|details)\/([a-zA-Z0-9_\\-]+)","soundcloud":"soundcloud\\.com\/([\\w-]+\/[\\w-]+)","niconico":"nicovideo\\.jp\/watch\/(sm[0-9]+)","bitchute":"bitchute\\.com\\\/video\\\/([a-zA-Z0-9_\\-]+)","coub":"coub\\.com\\\/view\\\/([a-zA-Z0-9_\\-]+)","odysee":"odysee\\.com\/\\$\/(?:embed|download)\/([-%_?=\/a-zA-Z0-9]+)","youku":"v\\.youku\\.com\/v_show\/id_([0-9A-Za-z=]+)\\.html","bilibili":"bilibili\\.com\\\/video\\\/(BV[0-9A-Za-z]+)","msoffice":"(?:office\\.com.*[&?]videoid=([a-z0-9\\-]+))","msstream":"microsoftstream\\.com\\\/video\\\/([a-f0-9\\-]{36})"}},"id":"tutorial:method:handshake_verification:start","namespace":"tutorial:method:handshake_verification","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script charset="utf-8" src="../../lib/exe/jquery.php.t.dokuwiki-light-export.js" defer="defer"></script>
<script charset="utf-8" src="../../lib/exe/js.php.t.dokuwiki-light-export.js" defer="defer"></script>
<!--<![endif]-->
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="../../favicon.ico" />
<link rel="apple-touch-icon" href="../../apple-touch-icon.png" />
    </head>

<body>
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_dokuwiki-light-export loggedIn    ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <h1><a href="../../start.html"  accesskey="" title=""><img src="../../logo.png" width="381" height="64" alt="" /></a></h1>
            </div>

    <div class="tools group">
        <!-- USER TOOLS -->
<!--
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li class="action profile"><a href="start.html" title="Profile" rel="nofollow"><span>Profile</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M2 3h20c1.05 0 2 .95 2 2v14c0 1.05-.95 2-2 2H2c-1.05 0-2-.95-2-2V5c0-1.05.95-2 2-2m12 3v1h8V6h-8m0 2v1h8V8h-8m0 2v1h7v-1h-7m-6 3.91C6 13.91 2 15 2 17v1h12v-1c0-2-4-3.09-6-3.09M8 6a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3z"/></svg></a></li><li class="action admin"><a href="start.html" title="Admin" rel="nofollow"><span>Admin</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 15.5A3.5 3.5 0 0 1 8.5 12 3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97 0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1 0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66z"/></svg></a></li><li class="action logout"><a href="start.html" title="Log Out" rel="nofollow"><span>Log Out</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M17 17.25V14h-7v-4h7V6.75L22.25 12 17 17.25M13 2a2 2 0 0 1 2 2v4h-2V4H4v16h9v-4h2v4a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9z"/></svg></a></li>                </ul>
            </div>
        -->
        <!-- SITE TOOLS -->
<!--
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
            <form action="../../start.html" method="get" role="search" class="search doku_form" id="dw__search" accept-charset="utf-8"><input type="hidden" name="do" value="search" /><input type="hidden" name="id" value="tutorial:method:handshake_verification:start" /><div class="no"><input name="q" type="text" class="edit" title="[F]" accesskey="f" placeholder="Search" autocomplete="on" id="qsearch__in" value="" /><button value="1" type="submit" title="Search">Search</button><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>            <div class="mobileTools">
                <form action="../..//doku.html.doku.php.html" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="tutorial:method:handshake_verification:start" /><input type="hidden" name="sectok" value="d6fffd2cb4652cbf16a8c7166736b2ad" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="edit">Edit this page</option><option value="revisions">Old revisions</option><option value="export_pdf">Export to PDF</option><option value="menuitemfolded">Fold/unfold all</option><option value="menuitem">Rename Page</option><option value="siteexport_addpage">Export Page to HTML/PDF</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Changes</option><option value="media">Media</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="profile">Profile</option><option value="admin">Admin</option><option value="logout">Log Out</option></optgroup></select><button type="submit">&gt;</button></div></form>            </div>
            <ul>
                <li class="action recent"><a href="start.html" title="Changes [r]" rel="nofollow" accesskey="r">Changes</a></li><li class="action media"><a href="start.html" title="Media" rel="nofollow">Media</a></li><li class="action index"><a href="start.html" title="Sitemap [x]" rel="nofollow" accesskey="x">Sitemap</a></li>            </ul>
        </div>
-->
    </div>

    <!-- BREADCRUMBS -->
<!--
    -->


    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">
                
                <div class="pageId"><span>tutorial:method:handshake_verification:start</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <div class="plugin_fastwiki_marker" style="display:none"></div><!-- TOC START -->
<div id="dw__toc" class="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#why_handshake_verification">Why handshake verification?</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#multi-signal_requests_and_acknowledgements">Multi-signal requests and acknowledgements</a></div></li>
<li class="level2"><div class="li"><a href="#signal_order">Signal order</a></div></li>
<li class="level2"><div class="li"><a href="#receptiveness">Receptiveness</a></div></li>
<li class="level2"><div class="li"><a href="#initial_state_of_handshake">Initial state of handshake</a></div></li>
<li class="level2"><div class="li"><a href="#signal_inversions">Signal inversions</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#handshake_wizard">Handshake wizard</a></div></li>
<li class="level1"><div class="li"><a href="#solutions">Solutions</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 id="handshakes_verification">Handshakes Verification</h1>
<div class="level1">

<p>
It is common to use <a href="https://en.wikipedia.org/wiki/Asynchronous_circuit#Protocols" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Asynchronous_circuit#Protocols">handshakes</a> for the communication between modules in asynchronous systems. This tutorial discusses the common pitfalls in using handshakes, and explains how to use the Handshake Wizard in Workcraft to formally verify handshakes. It focuses on control handshakes, and so does not deal with the data validity.
</p>

</div>

<h2 id="why_handshake_verification">Why handshake verification?</h2>
<div class="level2">

<p>
On the surface, the handshake protocol seems rather trivial – why would one want to verify it? Besides the generic remark that everything that can be verified must be verified, it turns out that the handshake protocol does have a number of pitfalls. As an example, consider a <em>Decoupler</em>: It communicates with two modules, <em>Left</em> and <em>Right</em>, by the handshakes <code><span style='color:red; '>rl</span></code> / <code><span style='color:blue; '>al</span></code> and <code><span style='color:blue; '>rr</span></code> / <code><span style='color:red; '>ar</span></code>, respectively. The idea is that Left can quickly complete its handshake with Decoupler and continue its execution, while Decoupler takes care of completing the (potentially slow) handshake with Right.
</p>

<p>
<img src="decoupler-interface.circuit.svg" width="330" height="80" class="svgscaleinsert mediacenter" alt="Decoupler interface">
</p>

<p>
Consider the following simple <abbr title="Signal Transition Graph">STG</abbr> describing the Decoupler component <span class="wrap_download "><a href="buggy-decoupler.stg.work" class="media mediafile mf_work" title="tutorial:method:handshake_verification:buggy-decoupler.stg.work (3.1 KB)">buggy-decoupler.stg.work</a> (3 KiB)</span>. Setting aside the issues of data validity (let&#039;s assume it is a purely control handshake) and efficiency (one can remove the negative signal edges from the critical path), can you spot the problem in this specification? 
</p>
<div class="wrap_center wrap_round wrap_alert plugin_wrap" style="width: 40%;">
<p>
<img src="buggy-decoupler.stg.svg" width="160" height="104" class="svgscaleinsert mediacenter" alt="Buggy decoupler">
</p>
</div>
<p>
The problem here is that Left can attempt to send another request before Decoupler completes its handshake with Right – indeed, Left has no way of knowing whether that handshake is completed. However, the specification does not capture this possibility, and assumes that Left will wait for the handshake between Decoupler and Right to complete. In other words, the assumptions about the environment&#039;s behaviour are incorrect: To fix this, one must enable <code><span style='color:red; '>rl+</span></code> immediately after <code><span style='color:blue; '>al-</span></code>, e.g. as follows <span class="wrap_download "><a href="decoupler.stg.work" class="media mediafile mf_work" title="tutorial:method:handshake_verification:decoupler.stg.work (3.3 KB)">decoupler.stg.work</a> (3 KiB)</span>:
</p>

<p>
<img src="decoupler.stg.svg" width="160" height="119" class="svgscaleinsert mediacenter" alt="Fixed decoupler">
</p>

<p>
The above bug can be caught if one verifies the <a href="../../../help/verification.html" class="wikilink1" title="help:verification" data-wiki-id="help:verification">N-way conformation</a> property of the overall system (Left can send an unexpected input to Decoupler, so the N-way conformation is violated), but it would be much better to catch such bugs at the level of a module – this would make the verification much simpler, and also will help with debugging (a violation trace for the N-way conformation will likely include activity in other modules, which is largely irrelevant but can make the trace very long).
</p>

<p>
Below we discuss potential complications with handshakes, including the described receptiveness pitfall.
</p>

</div>

<h3 id="multi-signal_requests_and_acknowledgements">Multi-signal requests and acknowledgements</h3>
<div class="level3">

<p>
It is possible (in fact, common) that more than two signals participate in a handshake. For example, there can be a dual-rail (or, in general, multiple-rail 1-hot) request (e.g. to specify the mode of operation) with a single-rail acknowledgement. Alternatively, the acknowledgement can be dual-rail (or, in general, multiple-rail 1-hot) to return some information to the caller. E.g. the <a href="../../design/vme_bus/start.html" class="wikilink1" title="tutorial:design:vme_bus:start" data-wiki-id="tutorial:design:vme_bus:start">VME bus controller</a> has a handshake {<code><span style='color:red; '>dsr</span></code>, <code><span style='color:red; '>dsw</span></code>} / <code><span style='color:blue; '>dtack</span></code> with a dual-rail request (to specify the mode of operation – read or write) and a single-rail acknowledgement.
</p>

<p>
In general, let REQ and ACK be two non-empty sets of signals. We assume that the signals in each set have the same type (either input or output), and the type of requests is opposite to the type of acknowledgements. The handshake is called <em>active</em> if REQ contains outputs (i.e. the module initiates the handshake) and <em>passive</em> if REQ contains inputs (i.e. another module initiates the handshake). Moreover, at most one request is allowed to be asserted at any time, and similarly for acknowledgements; in other words, the signals in sets REQ and ACK are mutually exclusive (i.e. 1-hot).
</p>

</div>

<h3 id="signal_order">Signal order</h3>
<div class="level3">

<p>
For a handshake <code>r</code> / <code>a</code> (it does not matter if it is passive or active), suppose the initial values of <code>r</code> and <code>a</code> are <code>0</code>. The handshake protocol requires that these signals follow the order <code>r+ a+ r- a-</code>. That is, there are four different states in a handshake, uniquely determined by the values of signals <code>r</code> and <code>a</code>, with the following requirements:
</p>
<ul>
<li class="level1"><div class="li"> <code>r=0 &amp; a=0</code>:   <code>r-, a+, a-</code> must be disabled;</div>
</li>
<li class="level1"><div class="li"> <code>r=1 &amp; a=0</code>:   <code>r+, r-, a-</code> must be disabled;</div>
</li>
<li class="level1"><div class="li"> <code>r=1 &amp; a=1</code>:   <code>r+, a+, a-</code> must be disabled;</div>
</li>
<li class="level1"><div class="li"> <code>r=0 &amp; a=1</code>:   <code>r+, r-, a+</code> must be disabled.</div>
</li>
</ul>

<p>
These conditions can be generalised to handshakes comprising multiple requests and/or acknowledgements in a natural way, as we assume that at most one request and at most one acknowledgement can be asserted at any time.
</p>

<p>
Note that these properties only require certain signal edges to be <em>disabled</em>. The receptiveness property discussed below imposes some enabledness requirements.
</p>

</div>

<h3 id="receptiveness">Receptiveness</h3>
<div class="level3">

<p>
The pitfall in the Decoupler example discussed above illustrates an important <em>receptiveness</em> property that should normally hold for handshakes. Suppose there is a single request and a single acknowledgement, and their initial values are <code>0</code>. 
</p>

<p>
Then for a passive handshake <code><span style='color:red; '>r</span></code> / <code><span style='color:blue; '>a</span></code>:
</p>
<ul>
<li class="level1"><div class="li"> if <code><span style='color:red; '>r</span>=0 &amp; <span style='color:blue; '>a</span>=0</code> then <code><span style='color:red; '>r+</span></code> must be enabled;</div>
</li>
<li class="level1"><div class="li"> if <code><span style='color:red; '>r</span>=1 &amp; <span style='color:blue; '>a</span>=1</code> then <code><span style='color:red; '>r-</span></code> must be enabled;</div>
</li>
</ul>

<p>
and for an active handshake <code><span style='color:blue; '>r</span></code> / <code><span style='color:red; '>a</span></code>:
</p>
<ul>
<li class="level1"><div class="li"> if <code><span style='color:blue; '>r</span>=1 &amp; <span style='color:red; '>a</span>=0</code> then <code><span style='color:red; '>a+</span></code> must be enabled;</div>
</li>
<li class="level1"><div class="li"> if <code><span style='color:blue; '>r</span>=0 &amp; <span style='color:red; '>a</span>=1</code> then <code><span style='color:red; '>a-</span></code> must be enabled.</div>
</li>
</ul>

<p>
These conditions can be generalised to handshakes comprising multiple requests and/or acknowledgements in a natural way, as we assume that at most one request and at most one acknowledgement can be asserted at any time.
</p>

<p>
There are, however, some exceptions, in particular when there are dependencies between different handshakes. In the following <abbr title="Signal Transition Graph">STG</abbr> <span class="wrap_download "><a href="call-final.stg.work" class="media mediafile mf_work" title="tutorial:method:handshake_verification:call-final.stg.work (3.7 KB)">call-final.stg.work</a> (4 KiB)</span>, the two passive handshakes <code><span style='color:red; '>r1</span></code> / <code><span style='color:blue; '>a1</span></code> and <code><span style='color:red; '>r2</span></code> / <code><span style='color:blue; '>a2</span></code> are mutually exclusive, as <code><span style='color:red; '>r1+</span></code> and <code><span style='color:red; '>r2+</span></code> disable each other. Hence, e.g., in a state with <code><span style='color:red; '>r1</span>=0 &amp; <span style='color:blue; '>a1</span>=0</code>, edge <code><span style='color:red; '>r1+</span></code> is not necessarily enabled as <code><span style='color:red; '>r2+</span></code> can fire and disable <code><span style='color:red; '>r1+</span></code>.
</p>

<p>
<img src="call-final.stg.svg" width="439" height="150" class="svgscaleinsert mediacenter" alt="STG with mutually exclusive handshakes">
</p>

<p>
In such a situation it would be reasonable to skip the receptiveness checks
for <code><span style='color:red; '>r1+</span></code> and <code><span style='color:red; '>r2+</span></code>
(while still keeping them for <code><span style='color:red; '>r1-</span></code> and <code><span style='color:red; '>r2-</span></code>). This, however, is not perfect – it would be reasonable in this case to modify these checks, e.g. to require that <code><span style='color:red; '>r1+</span></code> is enabled whenever <code><span style='color:red; '>r1</span>=0 &amp; <span style='color:blue; '>a1</span>=0 &amp; <span style='color:red; '>r2</span>=0 &amp; <span style='color:blue; '>a2</span>=0</code>, but this is not supported in Workcraft yet.
</p>

<p>
Alternatively, since the handshakes are mutually exclusive, one can treat these two handshakes as a single handshake {<code><span style='color:red; '>r1</span></code>, <code><span style='color:red; '>r2</span></code>} / {<code><span style='color:blue; '>a1</span></code>, <code><span style='color:blue; '>a2</span></code>}, which would satisfy the receptiveness property. However, this is not perfect either, as one may want to ensure that <code><span style='color:red; '>r1</span></code> is acknowledged specifically by <code><span style='color:blue; '>a1</span></code> rather than either <code><span style='color:blue; '>a1</span></code> or <code><span style='color:blue; '>a2</span></code>. Hence, one can combine this check with the ones for simple handshakes with relaxed receptiveness.
</p>

<p>
Note that if both <code><span style='color:red; '>r1</span></code> / <code><span style='color:blue; '>a1</span></code> and <code><span style='color:red; '>r2</span></code> / <code><span style='color:blue; '>a2</span></code> handshakes are with the same module in the environment, it would be advantageous to re-design the system by sharing the acknowledgement signal (by collapsing <code><span style='color:blue; '>a1</span></code> and <code><span style='color:blue; '>a2</span></code> into one signal <code><span style='color:blue; '>a12</span></code>), resulting in a handshake {<code><span style='color:red; '>r1</span></code>, <code><span style='color:red; '>r2</span></code>} / <code><span style='color:blue; '>a12</span></code> with a dual-rail request and a single-rail acknowledgement <span class="wrap_download "><a href="call-final-a12.stg.work" class="media mediafile mf_work" title="tutorial:method:handshake_verification:call-final-a12.stg.work (3.7 KB)">call-final-a12.stg.work</a> (4 KiB)</span> (the <abbr title="Signal Transition Graph">STG</abbr> can be simplified by merging the corresponding signal edges of <code><span style='color:blue; '>a12</span></code>). This <abbr title="Signal Transition Graph">STG</abbr> passes the receptiveness checks and results in a simpler circuit. However, this modification is not possible when <code><span style='color:red; '>r1</span></code> / <code><span style='color:blue; '>a1</span></code> and <code><span style='color:red; '>r2</span></code> / <code><span style='color:blue; '>a2</span></code> handshakes are with different modules.
</p>

<p>
<img src="call-final-a12.stg.svg" width="439" height="151" class="svgscaleinsert mediacenter" alt="STG with mutually exclusive handshakes and shared acknowledgement">
</p>

</div>

<h3 id="initial_state_of_handshake">Initial state of handshake</h3>
<div class="level3">

<p>
In some situations it may be convenient to initialise the circuit in a state that is different from the conventional initial state with both request and acknowledgement withdrawn – this may help to remove the initialisation logic from a  critical path. However, one has to be very careful when doing so – the pitfall is that the handshake may progress further than intended during the initialisation. One practical situation we observed was the initialisation of a module interacting with a <a href="../../../help/a2a/start.html" class="wikilink1" title="a2a:start" data-wiki-id="a2a:start">WAIT element</a> in a state with request <code><span style='color:blue; '>ctrl</span></code> being high. It may happen that <code><span style='color:red; '>sig</span></code> becomes high during initialisation, causing WAIT to raise acknowledgement <code><span style='color:red; '>san</span></code>. If the module relies on <code><span style='color:red; '>san</span></code> being low during its initialisation, it may be wrongly initialised; in fact, in such a situation it would be wrong to rely on either possible initial value of <code><span style='color:red; '>san</span></code>, as one has to control the initialisation of <code><span style='color:red; '>sig</span></code> to raise <code><span style='color:red; '>san</span></code> reliably, which is unlikely.
</p>

<p>
<img src="wait-interface.circuit.svg" width="268" height="80" class="svgscaleinsert mediacenter" alt="WAIT element interface">
</p>

</div>

<h3 id="signal_inversions">Signal inversions</h3>
<div class="level3">

<p>
One can often optimise the circuit implementation by changing the polarity of some signals – this may allow one to remove some inverters and/or replace positive logic gates by negative ones (note that CMOS logic is naturally inverting, and positive gates are usually obtained from their negative counterparts by appending an inverter, which increases the area and delay). Consider the following implementation of the above <abbr title="Signal Transition Graph">STG</abbr> with mutually exclusive handshakes. 
</p>

<p>
<img src="call-final.circuit.svg" width="183" height="191" class="svgscaleinsert mediacenter" alt="Circuit for the STG with mutually exclusive handshakes">
</p>

<p>
By changing the polarity of <code><span style='color:red; '>a</span></code>, one can get rid of the two inverters with zero delay assumptions (it is possible to optimise this circuit by using a single inverter for <code><span style='color:red; '>a</span></code>, whose output is then forked into the C-elements – the zero delay assumption would not be necessary in such a case; however, changing polarity still results in a smaller and faster circuit). Furthermore, by changing the polarity of <code><span style='color:blue; '>r</span></code> one can turn the OR-gate into a NOR-gate that is likely to be smaller and faster. (Of course, these transformations should be reflected in the design of the environment, and the achieved savings may sometimes be offset by the overheads introduced in the environment, so one should be careful.)
</p>

</div>

<h2 id="handshake_wizard">Handshake wizard</h2>
<div class="level2">

<p>
Workcraft&#039;s handshake wizard helps the user to formulate and verify the necessary handshake properties. It can be accessed via the <em>Verification→Handshake wizard [MPSat]…</em> menu item, and opens the following dialog (its appearance depends on whether the handshake is passive or active):
</p>
<div class="group plugin_wrap"><div class="wrap_column wrap_half plugin_wrap"><div class="table sectionedit7"><table class="inline">
	<tr class="row0">
		<td class="col0 centeralign">  <img src="handshake_wizard-passive.png" class="mediacenter" alt="" />  </td>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  Handshake wizard for <em>passive</em> handshake  </td>
	</tr>
</table></div>
</div><div class="wrap_column wrap_half plugin_wrap"><div class="table sectionedit10"><table class="inline">
	<tr class="row0">
		<td class="col0 centeralign">  <img src="handshake_wizard-active.png" class="mediacenter" alt="" />  </td>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  Handshake wizard for <em>active</em> handshake  </td>
	</tr>
</table></div>
</div></div>
<p>
First, the user specifies whether the handshake is passive or active. For passive handshakes, all inputs are listed as potential requests, and outputs as potential acknowledgements, and vice versa for active handshakes.
</p>

<p>
Then the user can select the requests and acknowledgements – as explained above, there can be multiple requests and/or multiple acknowledgements. Note that at least one request and at least acknowledgement must be selected, as otherwise the <kbd class="__keyboard"><code>  OK  </code></kbd> button will be disabled.
</p>

<p>
There are two receptiveness checks which depend on the type of the handshake, as explained above. They are enabled by default, but the user can disable one or both of them by un-checking the corresponding checkbox(es).
</p>

<p>
The user can also change the initial state of the handshake – the radio buttons and their labels are arranged to resemble a Petri net where a token shows the initial state.
</p>

<p>
If the polarity of at least one signal in a handshake differs from the default one, the user must also tick the “Allow arbitrary inversions of signals” checkbox. Note that the polarities can be deduced automatically, from the initial state of the handshake and the initial values of the signals participating in the handshake, so this checkbox is just a safety feature to inform the tool that the polarity changes are intentional rather than accidental.
</p>

</div>

<h2 id="solutions">Solutions</h2>
<div class="level2">

<p>
Download all the Workcraft models discussed in this tutorial here:
</p>

<p>
<span class="wrap_download "><a href="handshake_wizard.zip" class="media mediafile mf_zip" title="tutorial:method:handshake_verification:handshake_wizard.zip (17.4 KB)">All STGs and circuits</a> (17 KiB)</span>
</p>

</div>
<div class="level1">
<div class="plugin_include_content plugin_include__tutorial:feedback" id="plugin_include__tutorial__feedback">
<div class="wrap_hide plugin_wrap"><pre class="code">===== Feedback =====</pre>
<form class="bureaucracy__plugin" id="bureaucracy__plugin1" enctype="multipart/form-data" method="post" action="start.html" accept-charset="utf-8"><div class="no">
<input type="hidden" name="sectok" value="d6fffd2cb4652cbf16a8c7166736b2ad" /><input type="hidden" name="id" value="tutorial:method:handshake_verification:start" /><input type="hidden" name="bureaucracy[$$id]" value="1" /><fieldset ><legend>Comments or suggestions for improving this tutorial</legend>
<label><span>Name (optional)</span> <input type="text" name="bureaucracy[1]" class="edit" /></label>
<label><span>Email (optional)</span> <input type="text" name="bureaucracy[2]" class="edit" /></label>
<label class=" textareafield">
    <span>Feedback <sup>*</sup></span>
    <textarea name="bureaucracy[3]" id="" rows="10" cols="10" class="edit required&quot; required=&quot;required"></textarea>
</label><button type="submit">Submit</button>
</fieldset>
</div></form>
</div><div class="wrap_hide plugin_wrap"><ul>
<li class="level1"><div class="li"> As discussed in <a href="https://www.dokuwiki.org/plugin:include#controlling_header_size_in_included_pages" class="urlextern" title="https://www.dokuwiki.org/plugin:include#controlling_header_size_in_included_pages" rel="ugc nofollow">https://www.dokuwiki.org/plugin:include#controlling_header_size_in_included_pages</a>, by default, the headers in included pages start one level lower than the last header in the current page. This can be tweaked by adding an empty header above the include:\\<pre class="code">====== ======
{{page&gt;:tutorial:feedback&amp;inline}}</pre>
</div>
</li>
<li class="level1"><div class="li"> For offline help generation the content of <code>feedback</code> page should be temporary wrapped in <code>&lt;WRAP hide&gt;</code>. Note that the headers still propagate to the table of contents even if inside the hidden wrap. Therefore the <strong>Feedback</strong> title needs to be converted to something else, e.g. to code by adding two spaces in front.</div>
</li>
</ul>
</div></div>

</div>

                    <!-- wikipage stop -->
                                    </div>
<!--
                <div class="docInfo">
                    workcraft @ <bdi>tutorial/method/handshake_verification/start.txt</bdi> · Modified 2021/09/21 09:10 by <bdi>victor</bdi>                </div>
-->
                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
<!--
            <div id="dokuwiki__pagetools">
                            <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li class="edit"><a href="start.html" title="Edit this page [e]" rel="nofollow" accesskey="e"><span>Edit this page</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg></a></li><li class="revs"><a href="start.html" title="Old revisions [o]" rel="nofollow" accesskey="o"><span>Old revisions</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M11 7v5.11l4.71 2.79.79-1.28-4-2.37V7m0-5C8.97 2 5.91 3.92 4.27 6.77L2 4.5V11h6.5L5.75 8.25C6.96 5.73 9.5 4 12.5 4a7.5 7.5 0 0 1 7.5 7.5 7.5 7.5 0 0 1-7.5 7.5c-3.27 0-6.03-2.09-7.06-5h-2.1c1.1 4.03 4.77 7 9.16 7 5.24 0 9.5-4.25 9.5-9.5A9.5 9.5 0 0 0 12.5 2z"/></svg></a></li><li class="backlink"><a href="start.html" title="Backlinks" rel="nofollow"><span>Backlinks</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M10.59 13.41c.41.39.41 1.03 0 1.42-.39.39-1.03.39-1.42 0a5.003 5.003 0 0 1 0-7.07l3.54-3.54a5.003 5.003 0 0 1 7.07 0 5.003 5.003 0 0 1 0 7.07l-1.49 1.49c.01-.82-.12-1.64-.4-2.42l.47-.48a2.982 2.982 0 0 0 0-4.24 2.982 2.982 0 0 0-4.24 0l-3.53 3.53a2.982 2.982 0 0 0 0 4.24m2.82-4.24c.39-.39 1.03-.39 1.42 0a5.003 5.003 0 0 1 0 7.07l-3.54 3.54a5.003 5.003 0 0 1-7.07 0 5.003 5.003 0 0 1 0-7.07l1.49-1.49c-.01.82.12 1.64.4 2.43l-.47.47a2.982 2.982 0 0 0 0 4.24 2.982 2.982 0 0 0 4.24 0l3.53-3.53a2.982 2.982 0 0 0 0-4.24.973.973 0 0 1 0-1.42z"/></svg></a></li><li class="export_pdf"><a href="start.html" title="Export to PDF" rel="nofollow"><span>Export to PDF</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M14 9h5.5L14 3.5V9M7 2h8l6 6v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m4.93 10.44c.41.9.93 1.64 1.53 2.15l.41.32c-.87.16-2.07.44-3.34.93l-.11.04.5-1.04c.45-.87.78-1.66 1.01-2.4m6.48 3.81c.18-.18.27-.41.28-.66.03-.2-.02-.39-.12-.55-.29-.47-1.04-.69-2.28-.69l-1.29.07-.87-.58c-.63-.52-1.2-1.43-1.6-2.56l.04-.14c.33-1.33.64-2.94-.02-3.6a.853.853 0 0 0-.61-.24h-.24c-.37 0-.7.39-.79.77-.37 1.33-.15 2.06.22 3.27v.01c-.25.88-.57 1.9-1.08 2.93l-.96 1.8-.89.49c-1.2.75-1.77 1.59-1.88 2.12-.04.19-.02.36.05.54l.03.05.48.31.44.11c.81 0 1.73-.95 2.97-3.07l.18-.07c1.03-.33 2.31-.56 4.03-.75 1.03.51 2.24.74 3 .74.44 0 .74-.11.91-.3m-.41-.71l.09.11c-.01.1-.04.11-.09.13h-.04l-.19.02c-.46 0-1.17-.19-1.9-.51.09-.1.13-.1.23-.1 1.4 0 1.8.25 1.9.35M8.83 17c-.65 1.19-1.24 1.85-1.69 2 .05-.38.5-1.04 1.21-1.69l.48-.31m3.02-6.91c-.23-.9-.24-1.63-.07-2.05l.07-.12.15.05c.17.24.19.56.09 1.1l-.03.16-.16.82-.05.04z"/></svg></a></li><li class="menuitemfolded"><a href="javascript:void(0);" title="Fold/unfold all" rel="nofollow" class="fold_unfold_all_new" onclick="fold_unfold_all();"><span>Fold/unfold all</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M 2,0 L 6.5,3 L 2,6 z M 8,6.6 L 12.5,9.6 L 8,12.6 z M 14,13.2 L 20,13.2 L 17,17.7 z"/></svg></a></li><li class="menuitem"><a href="start.html" title="Rename Page" rel="nofollow" class=" plugin_move_page "><span>Rename Page</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M18,4V3A1,1 0 0,0 17,2H5A1,1 0 0,0 4,3V7A1,1 0 0,0 5,8H17A1,1 0 0,0 18,7V6H19V10H9V21A1,1 0 0,0 10,22H12A1,1 0 0,0 13,21V12H21V4H18Z" /></svg></a></li><li class="siteexport_addpage"><a href="start.html" title="Export Page to HTML/PDF" rel="nofollow"><span>Export Page to HTML/PDF</span><svg width="61px" height="51px" viewBox="0 0 61 51" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs></defs><path d="M26.1891503,39.0065635 L26.0876578,38.9773206 L60.6523866,1.23972885 L60.4321374,2.11844376 L60.476442,2.07071678 L60.4265202,2.14085429 L49.5024876,45.7237994 L32.8255882,40.9187101 L26,50.508302 L26,39.2103249 L26.1891503,39.0065635 Z M60.9727675,0.862917243 L22.2676619,38.2155059 L-0.00245042233,30.2214566 L60.9727675,0.862917243 Z" id="Paper-Plane"></path></svg></a></li><li class="top"><a href="#dokuwiki__top" title="Back to top [t]" rel="nofollow" accesskey="t"><span>Back to top</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg></a></li>                    </ul>
                </div>
                        </div>
-->
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<!--
<div id="dokuwiki__footer"><div class="pad">
    
    <div class="buttons">
                <a href="https://www.dokuwiki.org/donate" title="Donate" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="https://php.net" title="Powered by PHP" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="../../check/referer" title="Valid HTML5" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="../../css-validator/check/referer.fe4c581d16fb9f59f07485ddb441e467" title="Valid CSS" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="https://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="../../lib/tpl/dokuwiki-light-export/images/button-dw.png" width="80" height="15"
            alt="Driven by DokuWiki" /></a>
    </div>
</div></div>
-->
    </div></div><!-- /site -->

    <div class="no"><img src="../../lib/exe/taskrunner.b4cac6f145dbebcca2faa738673f0f33.gif" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div></body>
</html>
