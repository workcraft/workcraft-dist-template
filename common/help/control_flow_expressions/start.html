<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>help:control_flow_expressions:start - [Workcraft]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="theme-color" content="#008800"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="help,control_flow_expressions,start"/>
<link rel="search" type="application/opensearchdescription+xml" href="../lib/exe/opensearch.html" title="Workcraft"/>
<link rel="start" href="start.html"/>
<link rel="contents" href="start.html" title="Sitemap"/>
<link rel="manifest" href="../lib/exe/manifest.html"/>
<link rel="alternate" type="application/rss+xml" title="Changes" />
<link rel="alternate" type="application/rss+xml" title="Current namespace" />
<link rel="edit" title="Edit this page" href="start.html"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="../_export/xhtml/help/control_flow_expressions/start.xhtml"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="../_export/raw/help/control_flow_expressions/start.raw"/>
<link rel="canonical" href="http://192.168.0.4:8088/help/control_flow_expressions/start"/>
<link rel="stylesheet" href="../lib/exe/css.php.t.dokuwiki-light-export.css"/>
<!--[if gte IE 9]><!-->
<script >/*<![CDATA[*/var NS='help:control_flow_expressions';var SIG=" --- \/\/[[support@workcraft.org| ]] 2024\/01\/25 15:51\/\/";var JSINFO = {"fastwiki":{"secedit":1,"preview":1,"fastpages":1,"save":0,"fastshow":0,"fastshow_same_ns":1,"fastshow_include":"","fastshow_exclude":"","preload":0,"preload_head":"====47hsjwycv782nwncv8b920m8bv72jmdm3929bno3b3====","preload_batchsize":10,"preload_per_page":100,"locktime":840,"usedraft":1,"text_btn_show":"Show page","templatename":"dokuwiki-light-export"},"plugin_folded":{"hide":"hide","reveal":"reveal"},"move_renameokay":true,"plugins":{"vshare":{"youtube":"youtube\\.com\/.*[&?]v=([a-z0-9_\\-]+)","vimeo":"vimeo\\.com\\\/(\\d+)","slideshare":"slideshare.*id=(\\d+)","dailymotion":"dailymotion\\.com\/video\/([a-z0-9]+)","archiveorg":"archive\\.org\/(?:embed|details)\/([a-zA-Z0-9_\\-]+)","soundcloud":"soundcloud\\.com\/([\\w-]+\/[\\w-]+)","niconico":"nicovideo\\.jp\/watch\/(sm[0-9]+)","bitchute":"bitchute\\.com\\\/video\\\/([a-zA-Z0-9_\\-]+)","coub":"coub\\.com\\\/view\\\/([a-zA-Z0-9_\\-]+)","odysee":"odysee\\.com\/\\$\/(?:embed|download)\/([-%_?=\/a-zA-Z0-9]+)","youku":"v\\.youku\\.com\/v_show\/id_([0-9A-Za-z=]+)\\.html","bilibili":"bilibili\\.com\\\/video\\\/(BV[0-9A-Za-z]+)","msoffice":"(?:office\\.com.*[&?]videoid=([a-z0-9\\-]+))","msstream":"microsoftstream\\.com\\\/video\\\/([a-f0-9\\-]{36})"}},"id":"help:control_flow_expressions:start","namespace":"help:control_flow_expressions","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script src="../lib/exe/jquery.php.t.dokuwiki-light-export.js" defer="defer">/*<![CDATA[*/
/*!]]>*/</script>
<script src="../lib/exe/js.php.t.dokuwiki-light-export.js" defer="defer">/*<![CDATA[*/
/*!]]>*/</script>
<!--<![endif]-->
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="../favicon.ico" />
<link rel="apple-touch-icon" href="../apple-touch-icon.png" />
    </head>

<body>
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_dokuwiki-light-export loggedIn    ">

        
<!-- ********** HEADER ********** -->
<header id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <h1 class="logo"><a href="../start.html"  accesskey="" title=""><img src="../logo.png" width="381" height="64" alt="" /></a></h1>
            </div>

    <hr class="a11y" />
</div></header><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <main id="dokuwiki__content"><div class="pad group">
                
                <div class="pageId"><span>help:control_flow_expressions:start</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <div class="plugin_fastwiki_marker" style="display:none"></div><!-- TOC START -->
<div id="dw__toc" class="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#examples">Examples</a></div></li>
<li class="level1"><div class="li"><a href="#syntax">Syntax</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#comments">Comments</a></div></li>
<li class="level2"><div class="li"><a href="#actions_identifiers">Actions (identifiers)</a></div></li>
<li class="level2"><div class="li"><a href="#operators">Operators</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#translation">Translation</a></div></li>
<li class="level1"><div class="li"><a href="#pitfalls_with_the_iteration_operator">Pitfalls with the iteration operator</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#pitfall_1bad_interaction_with_choice_or_outer_iteration">Pitfall 1: Bad interaction with choice or outer iteration</a></div></li>
<li class="level2"><div class="li"><a href="#pitfall_2concurrency_in_the_body">Pitfall 2: Concurrency in the body</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#references">References</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 id="proflo_a_language_for_specifying_control_flows_of_processes">ProFlo – a language for specifying control flows of processes</h1>
<div class="level1">

<p>
ProFlo expressions <a href="#refnotes:1:note1" name="refnotes:1:ref1" class="refnotes-ref note-popup">[1]</a><a href="#refnotes:1:note2" name="refnotes:1:ref2" class="refnotes-ref note-popup">[2]</a> can be used for writing behavioural specifications which can be translated to Petri nets or STGs. In some situations this may be faster than drawing a Petri net or <abbr title="Signal Transition Graph">STG</abbr> in the visual editor. Moreover, there are situations when control flow expressions are straightforward to write but the equivalent Petri net is difficult to design manually (e.g. see Example 3 below).
</p>

</div>

<h2 id="examples">Examples</h2>
<div class="level2">

<p>
<strong>Example 1:</strong> Specification of an inverter with input <code><span style='color:red; '>in</span></code> and output <code><span style='color:blue; '>out</span></code>. It is assumed that the intial state of the signals is <code><span style='color:red; '>in</span>=0, <span style='color:blue; '>out</span>=1</code>, and that the environment is well-behaved, i.e. does not change the value of the input until the output changes:
</p>
<pre class="code">{ in+; out-; in1+; out+ }</pre>

<p>
Here the interpretation of actions (like <code>in+</code>) is as in STGs, operator <code>{…}</code> denotes iteration, i.e. the behavior in braces is repeated, and operator <code>;</code> denotes sequential composition, i.e. the four actions inside <code>{…}</code> are executed sequentially, one after another.
</p>

<p>
The tool can automatically generate an <abbr title="Signal Transition Graph">STG</abbr> from this expression:
</p>
<ul>
<li class="level1"><div class="li"> open Workcraft and create a new Signal Transition Graph (<abbr title="Signal Transition Graph">STG</abbr>) model;</div>
</li>
<li class="level1"><div class="li"> click the <em>Conversion→Translate ProFlo expression…</em> menu item;</div>
</li>
<li class="level1"><div class="li"> copy and paste the above expression to the text box in the Control Flow Logic Translator dialog and click <kbd class="__keyboard">   OK   </kbd>.</div>
</li>
</ul>

<p>
<img src="inverter-proflo.svg" width="136" height="37" class="svgscaleinsert mediacenter" alt="help:control_flow_expressions:inverter-proflo.svg">
</p>
<div class="wrap_center wrap_round wrap_tip plugin_wrap" style="width: 90%;">
<p>
Note that the above expression does not specify the types of signals, so the automatic translator uses the current types for the signals already existing in the <abbr title="Signal Transition Graph">STG</abbr> model, and makes the new signals internal, so one may have to amend the signal types in the generated <abbr title="Signal Transition Graph">STG</abbr> manually. The layout can also be improved manually (though we hope the tool will eventually generate better layout taking the syntax structure of the expression into account).
</p>
</div>
<p>
The sequential composition operator <code>;</code> can be omitted:
</p>
<pre class="code">{ in+ out- in- out+ }</pre>

<p>
Furthermore, spaces, tabs, new lines and comments can be arbitrarily added or removed (as long as adjacent identifiers are not glued together into one identifier), e.g. the following expressions are equivalent to the initial specification:
</p>
<pre class="code">{in+out-in-out+}</pre>
<pre class="code">  // this is a specification of an inverter with input in and output out,
  // augmented with long-winded hair-splitting comments
  { // begin iteration - the following behaviour is repeated 0 or more times:
    in+  // the environment is allowed to switch in from 0 to 1
    out+ // in response, the circuit must switch out from 1 to 0
    in-  // only after out+ has completed, the environment is allowed to switch in from 1 to 0
    out- // in response, the circuit must switch out from 0 to 1
  } // end iteration</pre>

<p>
<strong>Example 2:</strong> Specification of a C-element with inputs <code><span style='color:red; '>in1</span></code> and <code><span style='color:red; '>in2</span></code> and output <code><span style='color:blue; '>out</span></code>:
</p>
<pre class="code">{ (in1+ | in2+); out+; (in1- | in2-); out- }</pre>

<p>
Here, operator <code>|</code> is used to express the concurrency between inputs, and parentheses are used to override the default precedence of operators. The tool generates the following <abbr title="Signal Transition Graph">STG</abbr>:
</p>

<p>
<img src="c-element-proflo.svg" width="174" height="101" class="svgscaleinsert mediacenter" alt="help:control_flow_expressions:c-element-proflo.svg">
</p>

<p>
Again, the signal types in this <abbr title="Signal Transition Graph">STG</abbr> need to be amended manually.
</p>

<p>
<strong>Example 3:</strong> Choice between 10 pairs of concurrent events:
</p>
<pre class="code">  (a0 | b0) # (a1 | b1) # (a2 | b2) # (a3 | b3) # (a4 | b4) #
  (a5 | b5) # (a6 | b6) # (a7 | b7) # (a8 | b8) # (a9 | b9)</pre>

<p>
Here, operator <code>#</code> is used to express choices between pairs of concurrent events.
</p>

<p>
The resulting Petri net contains 20 transitions <code>a0,…,a9,b0,…,b9</code> and several synthesised places to enforce the choices. Note that manually designing such a Petri net (if `silent&#039; transitions are disallowed) would be very difficult. An optimal solution has six places, e.g.:
</p>

<p>
<img src="10-binary-bursts.svg" width="325" height="218" class="svgscaleinsert mediacenter" alt="help:control_flow_expressions:10-binary-bursts.svg">
</p>
<div class="wrap_center wrap_round wrap_tip plugin_wrap" style="width: 90%;">
<p>
The problem of synthesising a Petri net with minimum number of places is computationally expensive to solve exactly (it is in NP and may be NP-complete <a href="#refnotes:1:note2" name="refnotes:1:ref3" class="refnotes-ref note-popup">[2]</a>), so the current implementation of the exact algorithm takes too long to complete. This can be improved, e.g. by using a SAT solver. A fast heuristic method yields nine places. 
</p>
</div>
</div>

<h2 id="syntax">Syntax</h2>
<div class="level2">

</div>

<h3 id="comments">Comments</h3>
<div class="level3">

<p>
C++-style comments are supported:
</p>
<ul>
<li class="level1"><div class="li"> from <strong>//</strong> to the end of the line</div>
</li>
<li class="level1"><div class="li"> enclosed in <strong>/*…*/</strong> <span class="wrap_warning "><strong>Note:</strong> This style of comments is not supported yet.</span></div>
</li>
</ul>

</div>

<h3 id="actions_identifiers">Actions (identifiers)</h3>
<div class="level3">

<p>
For Petri net models, the action names are built of English letters (case sensitive), digits, and symbols <code>_$@:.</code> not starting with <code>.</code> or a digit. <span class="wrap_important ">Workcraft uses <code>.</code> symbol as the hierarchy separator (and it is not supported by the translator yet). Moreover, Workcraft does not support symbols <code>$@:</code> in the identifiers.</span>
</p>

<p>
For <abbr title="Signal Transition Graph">STG</abbr> models, the action names are as for Petri net models, but can optionally be postfixed with the signal edge, i.e. one of <code>+-~</code> symbols.
</p>

<p>
The same action can occur multiple times within an expression – different transitions with the same label will be created in such a case.
</p>

</div>

<h3 id="operators">Operators</h3>
<div class="level3">

<p>
The operators are as follows (<code>A</code> and <code>B</code> are arbitrary expressions):
</p>
<ul>
<li class="level1"><div class="li"> <strong>Sequential composition</strong> <code>A ; B</code> or just <code>A B</code></div>
</li>
<li class="level1"><div class="li"> <strong>Choice</strong> <code>A # B</code></div>
</li>
<li class="level1"><div class="li"> <strong>Concurrency</strong> (a.k.a <strong>Interleaving</strong>) <code>A | B</code></div>
</li>
<li class="level1"><div class="li"> <strong>Iteration</strong> <code>{ A }</code> </div>
</li>
</ul>
<div class="wrap_center wrap_round wrap_warning plugin_wrap" style="width: 90%;">
<p>
There are a few pitfalls when using the iteration, see below. At the moment, iteration is not properly supported, as incorrect Petri nets and STGs can be generated. For now, the only reasonably safe way of using iteration is to have a single outer iteration, i.e. when the whole expression has the form <code>{BODY}</code> where <code>BODY</code> does not use iteration and has some sequentiallity in each path.
</p>
</div>
<p>
The binary operators <code>;</code>, <code>#</code>, and <code>|</code> are given in the order of decreasing precedences, and parentheses <code>(…)</code> can be used to override the default precedence. All binary operators are associative; moreover, <code>#</code> and <code>|</code> are commutative.
</p>

</div>

<h2 id="translation">Translation</h2>
<div class="level2">

<p>
The translation of expressions (without iteration operator) to Petri nets is described in <a href="#refnotes:1:note1" name="refnotes:1:ref4" class="refnotes-ref note-popup">[1]</a><a href="#refnotes:1:note2" name="refnotes:1:ref5" class="refnotes-ref note-popup">[2]</a>.
</p>

<p>
The translation creates a Petri net or <abbr title="Signal Transition Graph">STG</abbr> transition for each atomic action in the expression. (If there are several occurrences of the same atomic action in the expression, a separate transition is created for each occurrence.) In particular, no `silent&#039; transitions (a.k.a. dummy transitions or ε-transitions) are created by the translation.
</p>

<p>
Then a set of places is synthesised to enforce the necessary sequencing and choice.
</p>

</div>

<h2 id="pitfalls_with_the_iteration_operator">Pitfalls with the iteration operator</h2>
<div class="level2">
<div class="wrap_center wrap_round wrap_todo plugin_wrap" style="width: 90%;">
<p>
The translation of iteration is currently under development, and has a number of issues, including both fundamental theoretical ones and implementation problems. At the moment, many uses of iteration result in incorrect Petri nets and STGs being generated. For now, the only reasonably safe way of using iteration is to have a single outermost iteration, i.e. when the whole expression has the form <code>{BODY}</code> where <code>BODY</code> does not use iteration and has some sequentiallity in each path through it.
</p>

<p>
There are a number of known pitfalls associated with the iteration operator. They can be solved by prefixing and/or postfixing the iteration with extra actions, i.e. making sure that iteration <code>{A}</code> is used in a context like <code>…;{A};…</code>, i.e. surrounded with <code>;</code>. 
</p>

<p>
Besides, even if these pitfalls are avoided, the current implementation often generates incorrect Petri nets or STGs.
</p>

<p>
Hopefully, one day the tool will be fixed and will analyse the syntax to detect these pitfalls and provide diagnostics.
</p>
</div>
</div>

<h3 id="pitfall_1bad_interaction_with_choice_or_outer_iteration">Pitfall 1: Bad interaction with choice or outer iteration</h3>
<div class="level3">

<p>
Consider the Petri net for <code>{a}#b</code>:
</p>

<p>
<img src="bad-choice-iter-beginning.svg" width="53" height="64" class="svgscaleinsert mediacenter" alt="help:control_flow_expressions:bad-choice-iter-beginning.svg">
</p>

<p>
Unfortunately, this Petri net has illegal traces like <code>a b</code>. Intuitively, the Petri net lacks a separate marking indicating that the decision has been made to execute the branch of the choice containing the iteration – in the above Petri net this marking is confused with the initial marking. If `silent&#039; transitions were allowed, one could model this with the following Petri net:
</p>

<p>
<img src="choice-iter-beginning-eps.svg" width="131" height="63" class="svgscaleinsert mediacenter" alt="help:control_flow_expressions:choice-iter-beginning-eps.svg">
</p>

<p>
Note that a similar problem can occur when iteration is nested within another iteration – the initial state of the outer iteration is effectively a choice between executing its body and skipping it, e.g. the Petri net for <code>{{a};b};c</code> allows the illegal trace <code>a c</code> (without <code>b</code>).
</p>

<p>
To work around problem, one should separate iteration from choice (or from outer iteration) with some sequencing, e.g. the following expressions avoid the problem: <code>(s;{a})#b</code>, <code>{s;{a};b};c</code>.
</p>

<p>
A similar problem occurs when the end of the iteration body interacts with the merge point of a choice (or the end of the outer iteration&#039;s body). For example, consider <code>((s;{a})#b);c</code>. The resulting Petri net is as follows:
</p>

<p>
<img src="bad-choice-iter-end.svg" width="88" height="124" class="svgscaleinsert mediacenter" alt="help:control_flow_expressions:bad-choice-iter-end.svg">
</p>

<p>
Note that it allows an illegal trace <code>b a</code>. Similarly, the Petri net for <code>{s;{a}}</code> allows the illegal trace <code>a</code> (without <code>s</code>).
</p>

</div>

<h3 id="pitfall_2concurrency_in_the_body">Pitfall 2: Concurrency in the body</h3>
<div class="level3">

<p>
Another pitfall is that concurrency in the body of iteration can result in unsafe Petri net. For example, consider the Petri net for <code>{a|b}</code>:
</p>

<p>
<img src="unsafe-iter-conc.svg" width="125" height="69" class="svgscaleinsert mediacenter" alt="help:control_flow_expressions:unsafe-iter-conc.svg">
</p>

<p>
Note that firing either <code>a</code> or <code>b</code> transition results in an unsafe (though 2-bounded) marking. Intuitively, the reason is that traces like <code>a b b</code> are possible, where the transition corresponding to <code>b</code> can fire twice (but not more) in a row – to model this without `silent&#039; transitions one needs two tokens on some place. As many verification and synthesis tools in Workcraft can work only with safe Petri nets or STGs, constructions like this should be avoided.
</p>

<p>
To work around this problem, one needs some sequencing in the body of the iteration, e.g. the Petri net for <code>{(a|b);(c|d)}</code> is safe.
</p>

</div>

<h2 id="references">References</h2>
<div class="level2">





</div>
<div class="refnotes">
<hr>
<div class="notes">
<div class="note reduced left">
<b><a name="refnotes:1:note1" class="nolink">[1]</a></b>
<span id="refnotes:1:note1:text">
V. Khomenko, M. Koutny, A. Yakovlev: <a href="https://doi.org/10.1007/978-3-031-06653-5_14" class="urlextern" title="https://doi.org/10.1007/978-3-031-06653-5_14" rel="ugc nofollow">Avoiding Exponential Explosion in Petri Net Models of Control Flows</a>. Proc. Petri Nets (2022) 261-277.
</span></div>
<div class="note reduced left">
<b><a name="refnotes:1:note2" class="nolink">[2]</a></b>
<span id="refnotes:1:note2:text">
V. Khomenko, M. Koutny, A. Yakovlev: <a href="https://doi.org/10.4230/LIPIcs.CONCUR.2022.8" class="urlextern" title="https://doi.org/10.4230/LIPIcs.CONCUR.2022.8" rel="ugc nofollow">Slimming Down Petri Boxes: Compact Petri Net Models of Control Flows</a>. Proc. CONCUR, Leibniz International Proceedings in Informatics (LIPIcs) 243 (2022) 8:1-8:16.
</span></div>
</div>
</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo">
                    Copyright &copy; 2014-2024 workcraft.org                </div>

                
                <hr class="a11y" />
            </div></main><!-- /content -->

        </div><!-- /wrapper -->

            </div></div><!-- /site -->

    <div class="no"><img src="../lib/exe/taskrunner.94ec507f66e723a1e56fb5398070981a.gif" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div></body>
</html>
